# SQL 기본 및 활용
# SQL 기본
## 정보 요구사항
### 1)정보 요구사항의 개념
- 정보 요구사항은 특정한 목적의 정보시스템 개발을 위해 업무의 개선 사항이나 신규 개발 사항을 요청하는 내용이다.
- 정보 요구사항은 현행 시스템 분석, 사용자 요구사항 수집, 제안 요청사, 사업 수행 계획서 등을 이용해 수집 가능하다.
### 2) 정보 요구사항 생명주기 모형
- 정보 요구사항의 생명주기는 정보 요구사항 수집, 정보 요구사항 분석/정의, 정보 요구사항 상세화, 정보 요구사항 검증으로 이루어진다.
- 정보 요구사항 생명주기 모형을 반복적으로 수행하여 사용자의 정보 요구사항이 정보시스템에 누락 없이 반영되어야 한다.

|순서|단계|설명|
|-|:-:|-|
|1|정보 요구사항 수집|- 사용자의 정보 요구사항을 수집하는 단계<br>- 사용자 면답, 관련 문서, 설문, 워크샵, 현행 시스템 분석 등을 통해 수집|
|2|정보 요구사항 분석 및 정의|- 사용자로부터 수집된 정보 요구사항을 정리하는 단계<br>- 방법론에서 제시하는 다양한 기법을 이용해 분석 및 정의|
|3|정보 요구사항 상세화|- 정보 요구사항의 개별 사항을 상세히 분석 및 기록하는 단계<br>- 정보 요구사항의 개별 사항을 상세히 분석 및 기록하는 단계<br>- 정보 요구사항이 시스템에 정확히 반영될 수 있도록 상세히 작성|
|4|정보 요구사항 검증|- 사용자의 정보 요구사항을 비즈니스 관점, 조직 관점, 애플리케이션 관점과 상관분석을 통해 누락 없이 반영되었는지 검증하는 단계|
### 3)정보 요구사항 유형
|유형|설명|
|:-:|-|
|외부 인터페이스 요건|- 시스템의 모든 입력과 출력에 관한 요건|
|기능 개선 요건|- 시스템에서 입력을 받아 처리하고 출력을 만들어 내는 주요 활동이나 프로세스에 대한 요건|
|성능 개선 요건|- 사용자가 원하는 성능 개선 사<br>- 동시 사용자 수, 처리하는 정보의 양과 종류, 트랜잭션 소요 시한 등의 요건|
|보안 개선 요건|- 중요 데이터에 대한 훼손, 변조, 도난, 유출에 대한 물리적 접근 통제(제한 구역, 통제 구역등)및 사용 통제(인증, 암호화, 방화벽 등)에 대한 요건|
## 관계형 데이터베이스 개요
### 1)데이터베이스
- 데이터베이스는 여러 사람이 공유하고 사용할 목적으로 컴퓨터 시스템에 전자적 방식으로 저장된 구조화된 정보 또는 데이터의 체계적인 집합이다.
- 자료를 구조화하여 중복된 데이터를 없애고 효율적인 처리를 할 수 있도록 관리된다.
- 데이터베이스를 관리 및 제어하고, 다수의 사용자가 데이터베이스 내에 데이터에 접근하여 이용할 수 있도록 해주는 소프트웨어를 데이터베이스관리시스템(DBMS)라고 한다.
### 2)데이터베이스 유형
|유형|설명|
|-|-|
|계층형|- 데이터 간의 관계가 트리 형태로 구성되어 있는 모델<br>- 계층 간 일대다(1:N)형태로 구성 가능<br>- 데이터를 세그먼트(레코드) 단위로 관리하고 세그먼트 간의 계층을 트리 구조로 관리|
|네트워크형|- 계층형 데이터베이스의 단점을 보완하여 데이터 간에 다대다(N:N)구성이 가능한 망형 모델|
|관계형|- 키와 값으로 이루어진 데이터들을 행과 열로 구성된 테이블 구조로 저장 및 관리하는 데이터베이스 모델<br>- SQL을 사용하여 데이터를 처리|
|객체 지향형|- 객체 지향 프로그래밍 개념에 기반하여 만들어진 데이터베이스 모델이며 정보를 객체의 형태로 표현|
|객체 관계형|- 관계형 데이터베이스에 객체 지향 개념을 도입한 데이터베이스 모델<br>- 객체 지향 개념을 지원하는 표준 SQL 사용가능|
|NoSQL|- 정형 데이터뿐만이 아니라 영상이나 이미지와 같은 비정형 데이터도 관리하기 위한 데이터베이스 모델|
|NewSQL|- 관계형 데이터베이스와 NoSQL의 장점을 결합한 데이터베이스 모델|
### 3)관계형 데이터베이스
#### 관계형 데이터베이스 개념
- 관계형 데이터베이스는 키와 값들의 관계를 직관적이고 간단하게 표현하는 방법인 관계형 모델을 기반으로 서로 관련된 데이터를 저장 및 관리하는 데이터베이스 유형이다.
- 1970년 E.F.Codd박사에 의해 제안됨

>관계형 데이터베이스의 특징

|특징|설명|
|:-:|-|
|정규화|정규화를 통해 이상현상(Anomaly)을 제거하고 중복을 배제|
|데이터 표준화|데이터 품질 확보|
|무결성 보장|다양한 제약조건을 통해 조건에 위배되는 데이터 입력이나 중요 데이터 삭제를 방지|
|회복성|시스템 다운, 재해/재난 등의 상황에서도 데이터를 회복/복구할 수 있는 기능 제공|
|동시 사용|동시성 관리, 병행 제어를 통해 많은 사용자들이 동시에 데이터를 조작 가능|
|보안 기능 제공|DBMS에 의해 인증된 사용자만이 참조할 수 있도록 보안 기능 제공|
#### 관계형 데이터베이스 주요 용어
|용어|설명|
|:-:|-|
|테이블|- 같은 속성을 공유하는 행(Row)들의 모임<br>- 행과 컬럼의 2차원 구조를 가진 데이터 저장소|
|열(Column)|- 테이블의 세로 방향<br>- 각각의 열은 유일한 이름을 가지고 있고, 자신만의 데이터 타입을 가짐<br>- 속성(Attribute)|
|행(Row)|- 테이블에서 가로 방향<br>- 관계된 데이터의 묶음<br>- 튜플(Tuple) 또는 레코드(Record)|
|값(Value)|- 각각의 행과 열에 대응하는 값|
|키(Key)|- 테이블에서 행의 식별자로 이용되는 열<br>- 기본키(Primary Key)|
|관계(Relationship)|- 테이블 간의 관계<br>- 일대일(One-to-One), 일대다(One-to-Many), 다대다(Many-to-Many)|
### 4)SQL(Structured Query Language)
SQL은 관계형 데이터베이스에서 데이터의 정의(Definition), 데이터 조작(Manipulation), 데이터 제어(Control)등을 위해 사용하는 언어이다.
|SQL 종류|명령어|설명|
|:-:|:-:|-|
|데이터 정의어<br>(DDL : Data Definition Language)|CREATE<BR>ALTER<BR>RENAME<BR>DROP<BR>TRUNCATE|테이블이나 인덱스 같은 데이터 구조를 정의하거나 수정, 삭제하는데 사용되는 명령어|
|데이터 조작어<br>(DML : Data Manipulation Language)|SELECT<BR>INSERT<BR>UPDATE<BR>DELETE|데이터베이스에 들어 있는 데이터를 조회하거나 변경하기 위한 명령어|
|데이터 제어어<br>(DCL : Data Control Language)|GRANT<BR>REVOKE|데이터베이스에 접근하거나 객체들을 사용할 수 있는 권한을 제어하기 위한 명령어|
|트랜잭션 제어어<br>(TCL : Transaction Control Language)|COMMIT<BR>ROLLBACK<BR>SAVEPOINT|트랜잭션을 제어하기 위한 명령어|
### 5)TABLE
- 테이블은 데이터를 저장하는 객체(Object)로서 관계형 데이터베이스의 기본 단위이다.
>테이블의 구조
>|-----|-----|열(Column)<br>속성(Attribute)|-----|
>|:-:|:-:|:-:|:-:|
>|-----|-----|-----|-----|
>|행(Row)<br>튜플(Tuple)<br>레코드(Record)|-----|-----|-----|
>|-----|-----|-----|-----|

## DDL
### 1)DDL의 개념 및 대상
#### DDL(Data Definition Language)의 개념
DDL은 데이터베이스의 테이블과 같은 데이터 구조나 구성 요소를 생성, 삭제, 변경하는 언어이다.
#### DDL의 대상
|DDL의 대상|설명|
|:-:|-|
|테이블(Table)|- 데이터를 저장하는 기본 저장 단위<br>- 행과 열로 구성|
|뷰(View)|- 하나 이상의 물리 테이블에서 유도되는 가상의 테이블|
|인덱스(Index)|- 검색 속도를 향상시키기 위한 데이터베이스 오브젝트|
|스키마(Schema)|- 데이터베이스의 구조와 제약조건에 관한 전반적인 명세를 기술한 메타데이터 집합|
#### 데이터 유형
- 컬럼을 정의할 때 선언한 데이터 유형은 해당 컬럼이 받아들일 수 있는 자료의 유형을 규정한다.
- 선언한 데이터 유형이 아닌 다른 유형의 데이터가 입력되거나 지정한 데이터의 크기를 넘어서는 자료가 입력되면 에러가 발생한다.
|유형|설명|
|:-:|-|
|CHARACTER(size)|길이가 size byte인 고정 길이 문자 데이터|
|VARCHAR(size)|최대 길이가 size인 가변길이 문자 데이터|
|NUMERIC|정수, 실수 등의 숫자 데이터|
|DATETIME|날짜와 시각 데이터|
### 2)DDL의 명령어
유형에 따라 생성, 수정, 삭제로 나뉜다.
|유형|명령어|설명|
|:-:|:-:|:-:|
|생성|CREATE|새로운 데이터베이스 개체 생성|
|수정|ALTER|이미 존재하는 데이터베이스 개체에 대한 변경|
||RENAME|개체의 이름을 변경|
|삭제|DROP|이미 존재하는 데이터베이스 개체 삭제|
||TRUNCATE|데이터베이스 개체에서 내용 삭제|
#### CREATE 명령어
`CREATE`명령어는 데이터베이스, 테이블 인덱스등을 생성하는 명령어이다.
>테이블 생성을 위한 CREATE TABLE 문법.
```SQL
CREATE TABLE 테이블명(
    컬럼명 데이터 유형 [NOT NULL],
    [컬럼명 데이터 유형 [NOT NULL], ...]
    CONSTRAINT 기본키명 PRIMARY KEY(컬럼명),
    CONSTRAINT 고유키명 UNIQUE(컬럼명[, 컬럼명,
    ...]),
    CONSTRAINT 외래키명 FOREIGN KEY(컬럼명) REFERENCES 참조테이블(참조테이블_기본키),
    CONSTRAINT 제약조건명 CHECK(조건식)
);
```
>테이블 생성시 주의사항

|주의사항|설명|
|:-:|-|
|적절한 이름|- 테이블의 이름은 객체를 의미할 수 있는 적절한 이름을 사용<br>- 가능한 단수형 사용|
|테이블 이름 중복|- 다른 테이블과 이름이 중복되지 않도록 함|
|컬럼 이름 중복|- 한 테이블 안에서는 컬럼 이름이 중복될 수 없음|
|데이터 유형|- 컬럼 뒤에 데이터 유형을 반드시 지정|
|문자로 시작|- 테이블 이름과 컬럼 이름은 반드시 문자로 시작<br>- 데이터베이스 공급업체(벤더)별로 이름 길이에 대한 제한 잇음<br>- A-Z, a-z, 0-9, _, $, # 문자만 허용|
|예약어|벤더에서 사전에 정의한 예약어는 사용 불가|


제약조건은 사용자가 원하는 조건의 데이터만 유지하기 위한 방법<br>
제약조건은 테이블의 특정 컬럼에 설정하는 제약이다.
>제약조건의 종류

|종류|설명|
|:-:|-|
|PRIMARY KEY<br>(기본키)||
|UNIQUE KEY<br>(고유키)||
|NOT NULL||
|CHECK||
|FOREIGN KEY<br>(외래키)||
|DEFAULT||

무결성은 데이터베이스에 저장된 값들이 정확하고 일관성 있는 데이터임을 나타내는 특성이다.<br>
무결성의 종류에는 개체 무결성, 참조 무결성 등이 있다.
>무결성의 종류

|종류|설명|DBMS 제약조건|
|-|-|-|
|개체 무결성|- 기본키 제약이라고도 하며, 하나의 테이블에 중복된 행이 존재하지 않도록 규정|UNIQUE, PRIMARY KEY|
|참조 무결성|- 행을 입력, 수정, 삭제할 때 연관되는 다른 테이블과의 데이터가 정확하게 유지되도록 규정<br>- 참조 관계에 있는 두 테이블의 데이터가 항상 일관된 값을 가져야함|FOREIGN KEY|


관계 테이블의 모든 외부 식별자 값은 관련 있는 관계 테이블의 모든 주 식별자 값이 존재해야 한다.
>참조 무결성 규칙 정의

자식테이블에 인스턴스 입력시 참조 무결성 규칙
>|규칙|설명|
>|-|-|
>|DEPENDENT|대응되는 부모 테이블에 인스턴스가 존재할 때만 자식 테이블에 입력 허용|
>|AUTOMATIC|자식 테이블의 인스턴스 입력을 항상 허용하고, 대응되는 부모 테이블에 인스턴스가 없는 경우 이를 자동으로 생성|
>|SET NULL|자식 테이블에 인스턴스의 입력을 항상 허용하고ㅡ 대응되는 부모 테이블에 인스턴스가 없는 경우 자식 테이블의 FK(외래키)를 NULL 값으로 입력|
>|SER DEFAULT|자식 테이블에 인스턴스의 입력을 항상 허용하고, 대응되는 부모 테이블에 인스턴스가 없는 경우 FK(외래키)를 지정된 기본값으로 입력|

부모 테이블의 인스턴스 삭제(또는 수정)시 참조 무결성 규칙
>|규칙|설명|
>|-|-|
>|RESTRICT|대응되는 자식 테이블의 인스턴스가 없는 경우에만 부모 테이블의 인스턴스 삭제를 허용|
>|CASCADE|부모 테이블의 인스턴스 삭제를 항상 허용하고, 대응되는 자식 테이블의 인스턴스를 자동 삭제|
>|SET NULL|부모 테이블의 인스턴스 삭제를 항상 허용하고 대응되는 자식 테이블의 인스턴스가 존재하면 FK(외래키)를 NULL값으로 수정|
>|SET DEFAULT|부모 테이블의 인스턴스 삭제를 항상 허용하고, 대응되는 자식 테이블의 인스턴스가 존재하면 FK(외래키)를 기본값으로 수정|

#### ALTER 명령어
`ALTER`명령어는 컬럼이나 제약조건을 추가/삭제하기위한 명령어이다.
|구분|문법|설명|
|:-:|-|-|
|컬럼 추가<br>(ADD)|`ALTER TABLE 테이블명 ADD 컬럼명 데이터 유형 [기본값][NOT NULL];`|테이블에 컬럼 추가|
|컬럼 수정<br>(MODIFY)|`ALTER TABLE 테이블명 MODIFY 컬럼명 데이터유형[기본값][NOT NULL];`|컬럼의 데이터 유형, 기본값, NOT NULL등의 제약조건에 대한 변경|
|컬럼 삭제<br>(DROP COLUMN)|`ALTER TABLE 테이블명 DROP COLUMN 삭제할컬럼명;`|컬럼을 삭제|
|컬럼명 수정<br>(RENAME COLUMN)|`ALTER TABLE 테이블명 RENAME COLUMN 기존컬럼명 TO 새로운컬럼명;`|컬럼명을 변경|
|제약조건 삭제<br>(DROP CONSTRAINT)|`ALTER TABLE 테이블명 DROP CONSTRAINT 제약조건명;`|기존 제약조건을 삭제|
|제약조건 추가<br>(ADD CONSTRAINT)|`ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명 제약조건 (컬럼명);`|테이블에 제약조건을 추가|
#### RENAME 명령어
`RENAME TABLE`은 테이블의 이름을 변경하는 명령어이다.
```SQL
RENAME 변경전테이블명 TO 변경후테이블명;
-- 테이블 이름을 변경
```
#### DROP TABLE 명령어
`DROP` 명령은 불필요한 테이블을 삭제하기 위한 명령어이다.
```SQL
DROP TABLE 테이블명 [CASCADE CONSTRAINT];
-- 테이블 모든 데이터와 구조까지 완전 삭제
```
#### TRUNCATE TABLE 명령어
`TRUNCATE` 명령은 테이블에 저장된 모든 행을 제거하고 저장 공간을 재사용할 수 있도록 해제하는 명령어이다.
```SQL
TRUNCATE TABLE 테이블명;
-- 테이블의 모든 행을 삭제
-- 최초 생성된 초기 상태로 만듬
```

#### DROP, TRUNCATE, DELETE비교
`DROP`, `TRUNCATE`, `DELETE`는 테이블/데이터를 삭제하는 명령어로 비교하면 다음과 같다.
|구분|DROP|TRUNCATE|DELETE|
|:-:|:-|:-|:-|
|명령어 종류|DDL|DDL|DML|
|Rollback|불가능|불가능|Commit 이전이면 Rollback가능|
|Commit|Auto Commit|Auto Commit|사용자 Commit|
|Release|테이블이 사용했던 Storage를 모두 Release|테이블이 사용했던 Storage중 최초 테이블 생성시 할당된 Storage만 남기고 Release|사용헀던 Storage는 Release되지 않음|
|삭제 상태|테이블 정의까지 완전히 삭제|최초 생성된 초기 상태로 만듦|데이터만 삭제|
|삭제 로그|로그 기록 없음|로그 기록 없음|로그 기록 있음|
## DML
### 1)DML(Data Manipulation Language)의 개념
- DML은 데이터베이스에 저장된 데이터를 조회, 입력, 수정, 삭제하는데 사용하는 질의어이다.
- DML은 비절차적 데이터 조작어이며, 사용자가 무슨(What)데이터를 원하는지만을 명세한다.
- C언어와 같은 호스트 프로그램 속에 삽입되어 사용되는 DML은 데이터 부속어(Data Sub Language)라고 한다.
### 2)DML의 유형
|유형|동작|설명|
|:-:|:-:|-|
|SELECT|데이터 조회|테이블을 구성하는 레코드 중에서 전체 또는 조건을 만족하는 레코드를 조회하는 명령어|
|INSERT|데이터 입력|테이블에 새로운 레코드를 입력할 때 사용하는 명령어|
|UPDATE|데이터 수정|테이블에 있는 레코드 중에서 특정 레코드의 내용을 변경할 때 사용하는 명령어|
|DELETE|데이터 삭제|테이블에 있는 레코드 중에서 특정 레코드를 삭제할 때 사용하는 명령어|
### 3)DML의 명령어
#### SELECT 명령어
`SELECT`명령어는 데이터의 내용을 조회할 때 사용하는 명령어이다.
```SQL
SELECT [ALL|DISTINCT] 컬럼명 AS 별명
FROM 테이블명;
-- SELECT절에서 WILDCARD및 ESCAPE 사용 가능
-- SELECT절에서 명시한 컬럼을 FROM절의 테이블에서 조회
-- ALL/DISTINCT : 생략가능, 생략시 ALL
-- DISTINCT : 중복된 데이터가 있는 경우 중복을 제거하여 1건만 조회하는 기능
-- AS : 생략가능
-- AS 키워드를 사용해 컬럼의 별명(ALIAS) 변경 가능
```
#### INSERT 명령어
`INSERT`명령어는 데이터의 내용을 입력할 때 사용하는 명령어이다.
```SQL
INSERT INTO 테이블명(컬럼명)
VALUES (입력값, ...);
-- 데이터를 입력하고자 하는 테이블의 컬럼을 정의하여 데이터를 입력
-- 컬럼과 입력값은 1:1로 매핑되며, 정의하지 않은 컬럼은 디폴트로 NULL
INSERT INTO 테이블명
VALUES 입력값;
-- 컬럼을 생략하는 경우 모든 컬럼을 대상으로 데이터 입력
-- 입력값은 테이블의 컬럼 수와 같아야 함
```
#### UPDATE 명령어
`UPDATE`명령어는 데이터의 내용을 수정할 때 사용하는 명령어이다.
```SQL
UPDATE 테이블명
    SET 컬럼명 = 입력값
WHERE 조건;
```
#### DELETE 명령어
`DELETE`명령어는 데이터의 내용을 삭제할 때 사용하는 명령어이다.
```SQL
DELETE [FROM] 테이블명
WHERE 조건;
```
### 4)산술 연산자와 합성 연산자
산술 연산자는 수학 계산을 위한 연산자, 합성 연산자는 문자와 문자를 연결하는 연산자
>`NULL`을 포함한 연산에 대해 산술연한은 결과가 `NULL`이고, 합성 연산은 `NULL`을 제외하고 연산한다.

|구분|연산자|설명|
|:-:|:-:|:-:|
||(&nbsp;&nbsp;&nbsp;&nbsp;)|괄호 안의 연산 우선순위를 높임|
||*|곱하기 연산을 수행|
|산술 연산자|/|나누기 연산을 수행|
||+|더하기 연산을 수행|
||-|빼기 연산을 수행|
|합성 연산자|\|\||문자와 문자를 연결|
## TCL
## WHERE 절
## FUNCTION
## GROUP BY, HAVING 절
## ORDER BY 절
## 조인